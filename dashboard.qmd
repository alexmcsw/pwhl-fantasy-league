---
title: "PWHL Fantasy League"
author: "Noah Bolohan"
format: dashboard
---

```{r}
library(tidyverse)
library(gt)

invisible(
    lapply(
        list.files(
            "./R",
            full.names = TRUE
        ),
        source
    )
)
```

```{r}
season <- 2025

all_teams <- team_stats(season)

schedule <- pwhl_schedule(
    season
)

player_boxes_per_game <- list()

for (game_id in schedule$game_id[1:5]) {
    player_boxes_per_game[[game_id]] <- pwhl_player_box(
        game_id=game_id
    )
}

rosters_idx <- get_google_sheet(
    sheetId = 0
)
```

```{r}
rosters_idx <- rosters_idx |>
    select(-team_name) |>
    t() |>
    data.frame() |>
    set_names(
        rosters_idx$team_name
    )

team_rosters <- rosters_idx |> map(
    filter_for_roster_idx,
    all_teams = all_teams
)

roster_points_per_game <- get_roster_points_per_game(
    team_rosters,
    player_boxes_per_game
)

standings <- compute_standings(
    roster_points_per_game
)

```

# Overview

## Row

```{r}



```

## Row

```{r}
standings |> gt()
```

# Team Standings

## Row

```{r}
standings |> gt()
```

## Row

```{r}
roster_points_per_game |>
mutate(
    across(
        names(team_rosters),
        ~ .x |> as.numeric() |> cumsum()
    ),
    game_idx = 1:nrow(
        roster_points_per_game
    )
) |>
pivot_longer(
    cols = names(team_rosters),
    names_to = "team_name",
    values_to = "cum_score"
) |>
ggplot() +
geom_line(
    aes(
        x = game_idx,
        y = cum_score,
        colour = team_name
    )
)
```

# Team Rosters

## Row {.tabset}

```{r}
#| title: Noah
team_rosters$Noah |> gt() |> text_transform(
    locations = cells_body(columns = player_headshot),
    fn = function(x) {
        web_image(
            url = x,
            height = "50px"
        )
    }
)
```

```{r}
#| title: Alex
team_rosters$Alex |> gt() |> text_transform(
    locations = cells_body(columns = player_headshot),
    fn = function(x) {
        web_image(
            url = x,
            height = "50px"
        )
    }
)
```

```{r}
#| title: Rambouillet
team_rosters$Rambouillet |> gt() |> text_transform(
    locations = cells_body(columns = player_headshot),
    fn = function(x) {
        web_image(
            url = x,
            height = "50px"
        )
    }
)
```

```{r}
#| title: Meadow
team_rosters$Meadow |> gt() |> text_transform(
    locations = cells_body(columns = player_headshot),
    fn = function(x) {
        web_image(
            url = x,
            height = "50px"
        )
    }
)
```